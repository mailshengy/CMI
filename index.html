<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>3D Scratch Card by Scratch</title>
<link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet">
<style>
  :root{
    --card-w: 450px;
    --card-h: 600px;
    --front-img-size: 410px;
    --front-top: 20px;
    --paper: #ffffff;
    --offwhite-bg: #F8F8F6;
    --edge: rgba(0,0,0,.08);
    --shadow-lg: 0 16px 40px rgba(0,0,0,.18), 0 6px 14px rgba(0,0,0,.12);
    --thickness-z: -3px;
    --holo-phase: 0deg;
    --holo-tilt-x: 0deg;
    --holo-intensity: 0.15;
    --holo-x: 50%;
    --holo-y: 45%;
  }

  body{
    margin:0; min-height:100vh;
    display:grid; place-items:center;
    background: var(--offwhite-bg);
    font-family: ui-sans-serif, system-ui, -apple-system;
  }

  .wrap{display:grid; justify-items:center; gap:12px; padding:16px;}
  .scene{width:min(96vw,520px);aspect-ratio:3/4;display:grid;place-items:center;perspective:1200px;user-select:none;touch-action:none;}

  .card{
    width:var(--card-w);height:var(--card-h);position:relative;
    transform-style:preserve-3d;transition:transform .6s cubic-bezier(.2,.8,.2,1);
    will-change:transform;
  }
  .card::after{content:"";position:absolute;inset:0;border-radius:16px;
    box-shadow:var(--shadow-lg);transform:translateZ(var(--thickness-z));pointer-events:none;}

  .face{
    position:absolute;inset:0;border-radius:16px;background:var(--paper);
    backface-visibility:hidden;-webkit-backface-visibility:hidden;transform-style:preserve-3d;
    background-image:
      radial-gradient(circle at 26% 22%, rgba(0,0,0,.028), transparent 42%),
      radial-gradient(circle at 74% 12%, rgba(0,0,0,.022), transparent 44%),
      repeating-linear-gradient(135deg, rgba(0,0,0,.012) 0 2px, transparent 2px 7px),
      repeating-linear-gradient(45deg, rgba(0,0,0,.01) 0 2px, transparent 2px 7px);
    background-blend-mode:multiply;
  }
  .back{transform:rotateY(180deg);}

  .front-art{
    position:absolute;top:var(--front-top);left:0;right:0;margin:auto;
    width:var(--front-img-size);height:var(--front-img-size);
    border-radius:12px;overflow:hidden;
    box-shadow:0 8px 18px rgba(0,0,0,.16), inset 0 0 0 1px rgba(255,255,255,.5);
    background-image:conic-gradient(from 0deg,#ff3d3d,#ff7a00,#ffd100,#5bd400,#00c2ff,#7b5cff,#ff4bd8,#ff3d3d);
    background-size:cover;
  }

  .front-art::after{
    content:"";position:absolute;inset:-35%;pointer-events:none;
    background:
      linear-gradient(calc(115deg + var(--holo-phase)),
        rgba(255,255,255,0) 0%,
        rgba(255,255,255,calc(.25 * var(--holo-intensity))) 16%,
        rgba(255,255,255,calc(.85 * var(--holo-intensity))) 22%,
        rgba(255,255,255,calc(.25 * var(--holo-intensity))) 28%,
        rgba(255,255,255,0) 42%),
      conic-gradient(
        from var(--holo-phase) at var(--holo-x) var(--holo-y),
        rgba(255,0,204,calc(.16 * var(--holo-intensity))),
        rgba(0,255,255,calc(.16 * var(--holo-intensity))),
        rgba(255,255,0,calc(.16 * var(--holo-intensity))),
        rgba(255,0,204,calc(.16 * var(--holo-intensity))));
    mix-blend-mode:screen;
    transform:rotateX(var(--holo-tilt-x)) translateZ(0);
  }

  /* Felt marker text under the image */
  .signature{
    position:absolute;
    top:calc(var(--front-top) + var(--front-img-size) + 30px);
    left:0; right:0; text-align:center;
    font-family:'Permanent Marker', cursive;
    font-size:30px; color:#333; letter-spacing:0.5px;
    transform:translateZ(1px);
    user-select:none;
  }

  .back-panel{
    position:absolute;top:var(--front-top);left:0;right:0;margin:auto;
    width:var(--front-img-size);height:var(--front-img-size);
    border-radius:12px;background:transparent;
    box-shadow:inset 0 0 0 1px rgba(0,0,0,.05);
    display:grid;place-items:center;color:#333;font-size:14px;text-align:center;padding:10px;
  }

  .ctrl{
    display:inline-grid;grid-auto-flow:row;align-items:center;justify-items:center;
    gap:4px;padding:8px 12px;border-radius:8px;background:#fff;
    border:1px solid rgba(0,0,0,.12);box-shadow:0 8px 20px rgba(0,0,0,.12);
    cursor:pointer;
    position: relative;
  top: 40px;  /* pushes it down 20px */
  }
  .ctrl svg{width:20px;height:20px;opacity:.9;}
  .ctrl .label{font-size:8px;line-height:1;color:#333;opacity:.8;}
  .ctrl[aria-pressed="true"]{border-color:#2563eb;}
  .controls{display:grid;justify-items:center;margin-top:4px;}
  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,1px,1px);white-space:nowrap;border:0;}
</style>
</head>
<body>
  <div class="wrap">
    <div class="scene" id="scene">
      <div class="card" id="card">
        <div class="face">
          <div class="front-art"></div>
          <div class="signature">SCRATCH CARD<br>BY SCRATCH</div>
        </div>
        <div class="face back">
          <div class="back-panel">With Love, Xoxo</div>
        </div>
      </div>
    </div>

    <div class="controls">
      <button class="ctrl" id="ctrl" aria-pressed="true">
        <span class="sr-only">Tap to start or stop. Hold to reset.</span>
        <svg id="icon-pause" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>
        <svg id="icon-play"  viewBox="0 0 24 24" fill="currentColor" style="display:none"><path d="M8 5v14l11-7z"/></svg>
        <span class="label">tap to start/stop â€¢ hold to reset</span>
      </button>
    </div>
  </div>

<script>
(() => {
  const scene = document.getElementById('scene');
  const card  = document.getElementById('card');
  const ctrl  = document.getElementById('ctrl');
  const iconPlay  = document.getElementById('icon-play');
  const iconPause = document.getElementById('icon-pause');
  let rotX=-6, rotY=24, scale=1;
  let dragging=false,lastX=0,lastY=0,activePointerId=null;
  let autoId=0,autoOn=true;
  const rootStyle=document.documentElement.style;
  let lastRY=rotY,lastRX=rotX;
  let pointerX=0.5,pointerY=0.45;
  const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
  function apply(){
    card.style.transform=`rotateX(${rotX}deg) rotateY(${rotY}deg) scale(${scale})`;
    updateHolo();
  }
  function updateHolo(){
    rootStyle.setProperty('--holo-phase',`${rotY}deg`);
    rootStyle.setProperty('--holo-tilt-x',`${rotX*0.25}deg`);
    const dRY=rotY-lastRY; const dRX=rotX-lastRX;
    const vMag=Math.min(1,Math.hypot(dRY,dRX)/12);
    const intensity=autoOn?Math.max(0.12,vMag):vMag;
    rootStyle.setProperty('--holo-intensity',intensity.toFixed(3));
    rootStyle.setProperty('--holo-x',`${pointerX*100}%`);
    rootStyle.setProperty('--holo-y',`${pointerY*100}%`);
    lastRY=rotY; lastRX=rotX;
  }
  const tick=()=>{rotY+=0.35;apply();autoId=requestAnimationFrame(tick);};
  function setAuto(on){
    autoOn=on;
    ctrl.setAttribute('aria-pressed',on?'true':'false');
    iconPause.style.display=on?'block':'none';
    iconPlay.style.display=on?'none':'block';
    cancelAnimationFrame(autoId);
    if(on)autoId=requestAnimationFrame(tick);
  }
  function flip(){rotY+=180;apply();}
  function onDown(e){
    e.preventDefault();
    dragging=true;activePointerId=e.pointerId;lastX=e.clientX;lastY=e.clientY;
    scene.setPointerCapture(activePointerId);cancelAnimationFrame(autoId);
  }
  function onMove(e){
    if(!dragging||e.pointerId!==activePointerId)return;
    const dx=e.clientX-lastX,dy=e.clientY-lastY;
    rotY+=dx*0.15;rotX-=dy*0.15;rotX=clamp(rotX,-75,75);
    const rect=card.getBoundingClientRect();
    pointerX=clamp((e.clientX-rect.left)/rect.width,0,1);
    pointerY=clamp((e.clientY-rect.top)/rect.height,0,1);
    lastX=e.clientX;lastY=e.clientY;apply();
  }
  function endDrag(){
    if(!dragging)return;
    dragging=false;
    if(activePointerId!==null){try{scene.releasePointerCapture(activePointerId);}catch(e){}}
    activePointerId=null;if(autoOn)setAuto(true);
  }
  scene.addEventListener('pointerdown',onDown,{passive:false});
  scene.addEventListener('pointermove',onMove,{passive:true});
  scene.addEventListener('pointerup',e=>{if(e.pointerId===activePointerId)endDrag();},{passive:true});
  scene.addEventListener('pointercancel',e=>{if(e.pointerId===activePointerId)endDrag();},{passive:true});
  scene.addEventListener('lostpointercapture',endDrag,{passive:true});
  scene.addEventListener('pointerleave',e=>{if(e.pointerId===activePointerId)endDrag();},{passive:true});
  window.addEventListener('pointerup',endDrag,{passive:true});
  scene.addEventListener('dblclick',flip,{passive:true});
  let tapTimer=0;
  scene.addEventListener('touchend',()=>{
    const now=Date.now();if(now-tapTimer<280)flip();tapTimer=now;
  },{passive:true});
  function reset(){rotX=-6;rotY=24;scale=1;apply();}
  let holdTimer=0;
  ctrl.addEventListener('click',()=>{
    if(ctrl.dataset.longpress==='1'){ctrl.dataset.longpress='0';return;}
    setAuto(!autoOn);
  });
  ctrl.addEventListener('pointerdown',()=>{holdTimer=setTimeout(()=>{ctrl.dataset.longpress='1';reset();},650);});
  ctrl.addEventListener('pointerup',()=>clearTimeout(holdTimer),{passive:true});
  ctrl.addEventListener('pointerleave',()=>clearTimeout(holdTimer),{passive:true});
  ctrl.addEventListener('pointercancel',()=>clearTimeout(holdTimer),{passive:true});
  apply(); setAuto(true);
})();
</script>
</body>
</html>
